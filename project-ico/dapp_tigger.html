<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>tigger-game</title>
    <meta name="description" content="description">
    <meta name="keywords" content="keywords">
    <link rel="stylesheet" href="dist/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="dist/css/dapp_pro.css">
</head>

<body class="dapp tigger-game">
    <div id="app">
        <app-component></app-component>
    </div>
    <script id="app-template" type="text/x-template">
        <div>
            <header>
                <div class="content">
                    <div class="logo">
                        <a href="index.html"></a>
                    </div>
                    <div class="nav">
                        <ul class="nav-list" id="menu">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="javascript:;" class="intro-btn">Introduction</a></li>
                            <!-- <li><a href="javascript:;">常见问题</a></li> -->
                        </ul>
                        <!-- <div class="lang">
                            <span>CH</span>
                            <ul>
                                <li id="en">EN</li>
                                <li id="ch">CH</li>
                            </ul>
                        </div> -->
                    </div>
                </div>
            </header>
            <div id="game-play-box">
                <div class="container" >
                    <div class="game-logo">
                        <p>All operations, player bets, results, winning management and distribution
                            of sales funds are recorded on the blockchain</p>
                    </div>
                    <div class="number-box">
                        <div id="machine1" class="slotMachine">
                            <div class="slot slot1"></div>
                            <div class="slot slot2"></div>
                            <div class="slot slot3"></div>
                            <div class="slot slot4"></div>
                            <div class="slot slot5"></div>
                            <div class="slot slot6"></div>
                            <div class="slot slot7"></div>
                            <div class="slot slot8"></div>
                        </div>
                        <div id="machine2" class="slotMachine">
                            <div class="slot slot1"></div>
                            <div class="slot slot2"></div>
                            <div class="slot slot3"></div>
                            <div class="slot slot4"></div>
                            <div class="slot slot5"></div>
                            <div class="slot slot6"></div>
                            <div class="slot slot7"></div>
                            <div class="slot slot8"></div>
                        </div>
                        <div id="machine3" class="slotMachine">
                            <div class="slot slot1"></div>
                            <div class="slot slot2"></div>
                            <div class="slot slot3"></div>
                            <div class="slot slot4"></div>
                            <div class="slot slot5"></div>
                            <div class="slot slot6"></div>
                            <div class="slot slot7"></div>
                            <div class="slot slot8"></div>
                        </div>
                    </div>
                    <div class="control-btn">
                        <!-- <button class="reset-btn">RESTART</button> -->
                        <div class="play-btn">
                            <span class="roll-btn"></span>
                        </div>
                        <div class="input-box">
                            <p>Enter your chips(<span>Max Bet {{maxBet}} ETH</span>)</p>
                            <div class="input-bet">
                                <input type="text" v-model="bet">
                                <div class="add-box">
                                    <span class="up-btn"></span>
                                    <span class="down-btn"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="get-bet">
                        <p>Please log in to the MetaMask purse and start the game.</p>
                    </div>
                </div>
                <!-- <div class="tabs-nav">
                    <ul>
                        <li class="active" name="tab1">历史记录</li>
                        <li name="tab2">我的订单</li>
                        <li name="tab3">玩法</li>
                        <li name="tab4">常见问题</li>
                        <li name="tab5">合同地址</li>
                    </ul>
                </div> -->
                <div class="show-container">
                    <div class="tabs-box">
                        <ul>
                            <li class="active" name="tab1">All Orders</li>
                            <li name="tab2">My Orders</li>
                        </ul>
                    </div>
                    <div class="content-show">
                        <div class="history-box" id="box1">
                            <table>
                                <thead>
                                    <tr>
                                        <th width="100">SERIAL</th>
                                        <th width="300">WALLET ADDRESS</th>
                                        <th width="100">BETS(ETH)</th>
                                        <th width="200">NUMBER</th>
                                        <th width="100">WINNING</th>
                                        <th width="100">AMOUNT(ETH)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(item,index) in historyDatas" v-if="index < 5">
                                        <td><div class="cell"><i>{{index + 1}}</i></div></td>
                                        <td><div class="cell"><i>{{item._player}}</i></div></td>
                                        <td><div class="cell"><i>{{eval('('+ item._betValue +')') / Math.pow(10,18)}}</i></div></td>
                                        <td>
                                            <div class="cell">
                                                <i>
                                                    <span v-bind:class="'icon_' + eval('('+ item._one +')')"></span>
                                                    <span v-bind:class="'icon_' + eval('('+ item._two +')')"></span>
                                                    <span v-bind:class="'icon_' + eval('('+ item._three +')')"></span>
                                                </i>
                                            </div> 
                                        </td>
                                        <td><div class="cell"><i>{{item._isWin ? 'YES' : 'NO'}}</i></div></td>
                                        <td><div class="cell"><i>{{eval('('+ item._winValue +')') / Math.pow(10,18)}}</i></div></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="my-box" id="box2">
                            <table>
                                <thead>
                                    <tr>
                                        <th width="100">SERIAL</th>
                                        <th width="300">WALLET ADDRESS</th>
                                        <th width="100">BETS(ETH)</th>
                                        <th width="200">NUMBER</th>
                                        <th width="100">WINNING</th>
                                        <th width="100">AMOUNT(ETH)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(item,index) in myOrders" v-if="index < 5">
                                        <td><div class="cell"><i>{{index + 1}}</i></div></td>
                                        <td><div class="cell"><i>{{item._player}}</i></div></td>
                                        <td><div class="cell"><i>{{eval('('+ item._betValue +')') / Math.pow(10,18)}}</i></div></td>
                                        <td>
                                            <div class="cell">
                                                <i>
                                                    <span v-bind:class="'icon_' + eval('('+ item._one +')')"></span>
                                                    <span v-bind:class="'icon_' + eval('('+ item._two +')')"></span>
                                                    <span v-bind:class="'icon_' + eval('('+ item._three +')')"></span>
                                                </i>
                                            </div> 
                                        </td>
                                        <td><div class="cell"><i>{{item._isWin ? 'YES' : 'NO'}}</i></div></td>
                                        <td><div class="cell"><i>{{eval('('+ item._winValue +')') / Math.pow(10,18)}}</i></div></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="container" id="game-intro" style="display:none;">
                <h4 class="back-play-btn">
                    <a href="javascript:;">
                        <img src="dist/imgs/game-back-btn.png" alt="">
                    </a>
                </h4>
                <div class="game-intro-box">
                    <img src="dist/imgs/game-intro.png" alt="">
                </div>
            </div>
            <div class="mask notice-mask">
                <div class="mask-tips">
                    <!-- <span class="close-btn"></span> -->
                    <h4>Tips</h4>
                    <p></p>
                    <a href="javascript:;" class="sure-btn">OK</a>
                </div>
            </div>
            <div class="mask result-mask">
                <div class="reuslt-box">
                    <img class="bg-light" src="dist/imgs/result-light.png" alt="">
                    <div class="notice">
                        <img  src="dist/imgs/result-tigger.png" alt="">
                        <span class="win-value"></span>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script src="dist/js/jquery.min.js"></script>
    <script src="dist/js/vue.min.js"></script>
    <script src="dist/web3/web3.min.js"></script>
    <script src="dist/js/jquery.slotmachine.js"></script>
    <script>
        Vue.component('app-component', {
            template: '#app-template',
            data() {
                return {
                    hash: '',
                    switch: true,
                    machine1: '',
                    machine2: '',
                    machine3: '',
                    account: '',
                    bet: 0.01,
                    playerBetValue: 0.1 * Math.pow(10,18),
                    playerWinValue: 0,
                    playerAddress: '',
                    minBet: 0,
                    maxBet: 0,
                    roundNO: 0,
                    isActive: '',
                    gameClass: 0,
                    gameNumberOne: 0,
                    gameNumberTwo: 0,
                    gameNumberThree: 0,
                    historyDatas: [],
                    myOrders: [],
                    address: "0xB7d5ef779D2ea56aA9B9EfD016E926f1Bed5A273",
                    abi: [{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"playerAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"roundNO","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isActive","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint8"}],"name":"winRate","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lotteryPool","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxBet","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"playerWinValue","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"gameNumberThree","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_isActive","type":"bool"}],"name":"changeGameState","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"buyLottery","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"minBet","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"a","type":"uint256"},{"name":"b","type":"uint256"}],"name":"safeSub","outputs":[{"name":"c","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"gameClass","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"gameNumberTwo","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"a","type":"uint256"},{"name":"b","type":"uint256"}],"name":"safeDiv","outputs":[{"name":"c","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"playerBetValue","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"a","type":"uint256"},{"name":"b","type":"uint256"}],"name":"safeMul","outputs":[{"name":"c","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"gameNumberOne","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"a","type":"uint256"},{"name":"b","type":"uint256"}],"name":"safeAdd","outputs":[{"name":"c","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[],"name":"ownerWithdrawal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_roundNo","type":"uint256"},{"indexed":true,"name":"_player","type":"address"},{"indexed":true,"name":"_isWin","type":"bool"},{"indexed":false,"name":"_betValue","type":"uint256"},{"indexed":false,"name":"_one","type":"uint8"},{"indexed":false,"name":"_two","type":"uint8"},{"indexed":false,"name":"_three","type":"uint8"},{"indexed":false,"name":"_winValue","type":"uint256"}],"name":"LogLotteryEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_form","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"}],
                }
            },
            created() {
                var vm = this;
            },
            watch: {},
            methods: {
                relustShow: function(text,bg) {
                    $('.result-mask').show();
                    $('.reuslt-box .notice').find('img').attr('src',bg)
                    if(text > 0) {
                        $('.win-value').html(text + ' ' +'ETH');
                    }
                   
                },
                noticeText: function(text) {
                    $('.notice-mask').show();
                    $('.mask-tips').find('p').html(text);
                },
                init: function(contractInstance) {
                    var vm = this;
                    //查询数据 minBet 最小赌注
                    var minBet = contractInstance.minBet.call(function(error, res){
                        if (!error) {
                            // console.log('minBet',eval("("+res+")"));
                            vm.minBet = eval("("+res+")") / Math.pow(10,18);
                        }
                    })

                    //查询数据 maxBet 最大赌注
                    var maxBet = contractInstance.maxBet.call(function(error, res){
                        if (!error) {
                            // console.log('maxBet',eval("("+res+")"));
                            vm.maxBet = eval("("+res+")") / Math.pow(10,18);
                        }
                    })

                    var roundNO = contractInstance.roundNO.call(function(error, res){
                        if (!error) {
                            // console.log('roundNO',eval("("+res+")"));
                            vm.roundNO = eval("("+res+")");
                            console.log('roundNO',vm.roundNO)
                        }
                    })



                    //查询数据 isActive 游戏激活关闭状态
                    var isActive = contractInstance.isActive.call(function(error, res){
                        if (!error) {
                            // console.log('isActive',res);
                        }
                    })
                    //查询数据 lotteryPool  奖金池以太币数量
                    var lotteryPool = contractInstance.lotteryPool.call(function(error, res){
                        if (!error) {
                            // console.log('lotteryPool',eval("("+res+")"));
                        }
                    })

                    //查询数据 gameClass  水果种类
                    var gameClass = contractInstance.gameClass.call(function(error, res){
                        if (!error) {
                            // console.log('gameClass',eval("("+res+")"));
                        }
                    })         
                },
                contract: function(contractInstance) {
                    var vm = this;
                    //查询数据 minBet 最小赌注
                    var minBet = contractInstance.minBet.call(function(error, res){
                        if (!error) {
                            // console.log('minBet',eval("("+res+")"));
                            vm.minBet = eval("("+res+")") / Math.pow(10,18);
                        }
                    })

                    //查询数据 maxBet 最大赌注
                    var maxBet = contractInstance.maxBet.call(function(error, res){
                        if (!error) {
                            // console.log('maxBet',eval("("+res+")"));
                            vm.maxBet = eval("("+res+")") / Math.pow(10,18);
                        }
                    })

                    //查询数据 roundNO 下注轮数，全局累加
                    var roundNO = contractInstance.roundNO.call(function(error, res){
                        if (!error) {
                            // console.log('roundNO',eval("("+res+")"));
                            var value = res;
                            vm.roundNO = eval("("+res+")");
                            console.log('roundNO',vm.roundNO)

                            //查询数据 gameNumberOne  个位随机数
                            var gameNumberOne = contractInstance.gameNumberOne(value,function(error, res){
                                if (!error) {
                                    // console.log('gameNumberOne',eval("("+res+")"));
                                    vm.gameNumberOne = eval("("+res+")");
                                    vm.machine1.stop(true,eval("("+res+")"));
                                }
                            })

                            //查询数据 gameNumberTwo  十位随机数
                            var gameNumberTwo = contractInstance.gameNumberTwo(value,function(error, res){
                                if (!error) {
                                    // console.log('gameNumberTwo',eval("("+res+")"));
                                    vm.gameNumberTwo = eval("("+res+")");  
                                    vm.machine2.stop(true,eval("("+res+")"));
                                }
                            })

                            //查询数据 gameNumberThree  百位随机数
                            var gameNumberThree = contractInstance.gameNumberThree(value,function(error, res){
                                if (!error) {
                                    // console.log('gameNumberThree',eval("("+res+")"));
                                    vm.gameNumberThree = eval("("+res+")");
                                    vm.machine3.stop(true,eval("("+res+")"));
                                }
                            })

                            //查询数据 playerBetValue  玩家下注数量
                            var playerBetValue = contractInstance.playerBetValue(value,function(error, res){
                                if (!error) {
                                    // console.log('playerBetValue',eval("("+res+")") / Math.pow(10,18));
                                }
                            })

                            //查询数据 playerWinValue  玩家赢的数量
                            /*var playerWinValue = contractInstance.playerWinValue(value,function(error, res){
                                if (!error) {
                                    // console.log('playerWinValue',eval("("+res+")"));
                                    vm.playerWinValue = eval("("+res+")");
                                    if(vm.playerWinValue) {
                                        $('body').find('.get-bet').html('<p class="win">恭喜您，获得了<span>'+ vm.playerWinValue +'ETH</span>您所赢得的BYS 已放入您的钱包</p>');
                                    } else {
                                        $('body').find('.get-bet').html('<p class="loss">很遗憾，您没有中奖，继续努力哦！</p>');
                                    }
                                }
                            })*/

                            //查询数据 playerAddress  下注玩家地址
                            var playerAddress = contractInstance.playerAddress(value,function(error, res){
                                if (!error) {
                                    // console.log('playerAddress',res);
                                    vm.playerAddress = res;
                                }
                            })
                        }
                    })
                    //查询数据 isActive 游戏激活关闭状态
                    var isActive = contractInstance.isActive.call(function(error, res){
                        if (!error) {
                            // console.log('isActive',res);
                        }
                    })
                    //查询数据 lotteryPool  奖金池以太币数量
                    var lotteryPool = contractInstance.lotteryPool.call(function(error, res){
                        if (!error) {
                            // console.log('lotteryPool',eval("("+res+")"));
                        }
                    })

                    //查询数据 gameClass  水果种类
                    var gameClass = contractInstance.gameClass.call(function(error, res){
                        if (!error) {
                            // console.log('gameClass',eval("("+res+")"));
                        }
                    })         
                },
                accAdd: function(arg1, arg2) {
                    var r1, r2, m, c;  
                    try { r1 = arg1.toString().split(".")[1].length } catch (e) { r1 = 0 }  
                    try { r2 = arg2.toString().split(".")[1].length } catch (e) { r2 = 0 }  
                    c = Math.abs(r1 - r2);  
                    m = Math.pow(10, Math.max(r1, r2))  
                    if (c > 0) {  
                        var cm = Math.pow(10, c);  
                        if (r1 > r2) {  
                            arg1 = Number(arg1.toString().replace(".", ""));  
                            arg2 = Number(arg2.toString().replace(".", "")) * cm;  
                        }  
                        else {  
                            arg1 = Number(arg1.toString().replace(".", "")) * cm;  
                            arg2 = Number(arg2.toString().replace(".", ""));  
                        }  
                    }  
                    else {  
                        arg1 = Number(arg1.toString().replace(".", ""));  
                        arg2 = Number(arg2.toString().replace(".", ""));  
                    }  
                    return (arg1 + arg2) / m 
                },
                accSub: function(arg1,arg2) {
                    var r1,r2,m,n;  
                    try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}  
                    try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}  
                    m=Math.pow(10,Math.max(r1,r2));  
                    //last modify by deeka  
                    //动态控制精度长度  
                    n=(r1>=r2)?r1:r2;  
                    return ((arg1*m-arg2*m)/m).toFixed(n);
                },
                getDatas: function(events) {
                    var vm = this;
                    events.get(function(error, logs){
 
                        vm.myOrders = [];

                        if(!error) {
                            for(var i = 0;i< logs.length;i++) {

                                vm.historyDatas.unshift(logs[i].args);

                                if(logs[i].args._player == vm.account[0]) {
                                    vm.myOrders.unshift(logs[i].args);
                                }
                            }
                        } else {
                            console.log('error',error)
                        }
                    });
                }
            },
            mounted() {
                var vm = this;

                vm.machine1 = $("#machine1").slotMachine({
                    active  : 0,
                    delay   : 500
                });

                vm.machine2 = $("#machine2").slotMachine({
                    active  : 1,
                    delay   : 500
                });
                vm.machine3 = $("#machine3").slotMachine({
                    active  : 2,
                    delay   : 500
                });

                if (typeof web3 !== 'undefined') {                            
               
                    window.web3 = new Web3(web3.currentProvider);
                } else {                                                                             
                    window.web3 = new Web3(new Web3.providers.HttpProvider('https://mainnet.infura.io/0rBNkNJthXDWDNrQeweR')); 
                } 

                // 返回当前节点持有的帐户列表
                web3.eth.getAccounts(function(error,res) {//异步
                    vm.account = res;

                    // 获取用户账户余额
                    var amount = web3.eth.getBalance(vm.account[0],function(error,res) {
                        console.log('余额',eval("("+res+")") / Math.pow(10,18));
                    })
                });
                
                //  实时监测账号变化
                var account = setInterval(function() {
                    web3.eth.getAccounts(function(error,res) {//异步
                        if(vm.account[0] && vm.account[0] != res[0]) {
                            vm.account = res;
                            vm.getDatas(events);
                            $('body').find('.get-bet').html('');
                            $('.play-btn').find('.roll-btn').removeClass('active');
                        }
                    });
                },100)
                


                // 初始化
                var MyContract = web3.eth.contract(vm.abi);
                var contractInstance = MyContract.at(vm.address);
                vm.init(contractInstance);

                // 开始游戏 交易
                $('body').on('click','.play-btn',function() {
                    var o = $(this);
                    // 判断用户当前钱包
                    web3.eth.getAccounts(function(error,res) {//异步
                        vm.account = res;
                        if(vm.switch && vm.bet >= 0.01) {
                            if(!vm.account[0]) {
                                vm.noticeText('Please login metaMask !');
                                return;
                            } else {
                                if(!o.find('.roll-btn').hasClass('active')) {

                                    o.find('.roll-btn').addClass('active');
                                    vm.switch = false;
                                    
                                    // submit value and address
                                    contractInstance.buyLottery.sendTransaction({ from: vm.account[0] ,value:vm.bet * Math.pow(10,18)},function(error,result) {
                                        console.log('res',result);
                                        if(result) {
                                            $('body').find('.get-bet').html('<p class="sending">Your transaction '+ result +' In the sending  <span></span></p>');
                                            vm.machine1.shuffle();

                                            setTimeout(function(){
                                                vm.machine2.shuffle();
                                            }, 500);

                                            setTimeout(function(){
                                                vm.machine3.shuffle();
                                            }, 1000);
                                        } else {
                                            $('.play-btn').find('.roll-btn').removeClass('active');
                                            vm.switch = true;
                                            $('body').find('.get-bet').html('');
                                        }
                                    })
                                } else {
                                    return;
                                }
                            }
                        } else {
                            if(vm.bet < 0.01) {
                                vm.noticeText('The min amount to be injected is 0.01EHT');
                            } else if(!vm.switch) {
                                vm.noticeText('The game is in progress, please wait a minute');
                            }
                        }
                    });
                    
                })

                //监听合约中的 LogLotteryEvent 事件
                contractInstance.LogLotteryEvent().watch(function(error,result) {
                    if(!error) {
                        if(result.args._player == vm.account[0] && eval('('+ result.args._roundNo +')') != vm.roundNO ) {
                            // console.log('LogLotteryEvent',result)
                            vm.myOrders.unshift(result.args);
                            vm.contract(contractInstance);
                            vm.switch = true;
                            $('.play-btn').find('.roll-btn').removeClass('active');

                            contractInstance.playerWinValue(vm.roundNO,function(error, res){
                                if (!error) {
                                    console.log('playerWinValue',eval("("+res+")"));
                                    vm.playerWinValue = eval("("+res+")") / Math.pow(10,18);

                                    if(vm.playerWinValue) {
                                        $('body').find('.get-bet').html('<p class="win">Congratulations  You Win <span>'+ vm.playerWinValue +'ETH</span> you win bys to put in your wallet</p>');
                                        var bg = '/dist/imgs/result-tigger.png';        
                                        vm.relustShow(vm.playerWinValue,bg);

                                    } else {
                                        $('body').find('.get-bet').html("<p class='loss'>It's a pity that you don't win the prize and continue to work hard！</p>");
                                        
                                        var bg = '/dist/imgs/reuslt-tigger-lost.png'
                                        vm.relustShow(0,bg);
                                    }
                                }
                            })
                        }
                        if(vm.roundNO != eval('('+ result.args._roundNo +')')) {
                            vm.historyDatas.unshift(result.args);
                        }
                    }
                });
                
                // 获取历史数据
                var events = contractInstance.LogLotteryEvent({some: 'args'},{fromBlock: 0, toBlock: 'latest'});
                vm.getDatas(events);

                
                // 用户投注金额操作
                $('body').on('click','.up-btn',function() {
                    if(vm.bet < 1) {
                        vm.bet = vm.accAdd(vm.bet,0.01);
                    } else {
                        return
                    }
                })
                $('body').on('click','.down-btn',function() {
                    if(vm.bet > 0.01 ) {
                        vm.bet = vm.accSub(vm.bet,0.01);
                    } else {
                        return
                    }
                })

                // 选择dapp 种类
                $('body').on('click','.dapp-btn',function() {
                   $('.dropdown-menu').fadeIn('slow');
                })
                document.addEventListener('click',function(e) {
                    $('.dropdown-menu').hide();
                    $('.notice-mask').hide();
                },true);
                $('body').on('click','.sure-btn',function() {
                    $('.notice-mask').hide();
                })

                // nav 导航栏
                $('body').on('click','.tabs-box li',function() {
                    if(!$(this).hasClass('active')) {
                        $(this).addClass('active').siblings('li').removeClass('active');
                    }

                    var showname = $(this).attr('name');
                    console.log(showname)
                    switch (showname) {
                        case 'tab1':
                            $('#box1').show().siblings().hide();
                            break;
                        case 'tab2':
                            $('#box2').show().siblings().hide();
                            break;
                    }
                })

                // header 导航
                $('.intro-btn').click(function() {
                    $('#game-play-box').hide().siblings('#game-intro').show();
                })
                $('.back-play-btn a').click(function() {
                    $('#game-intro').hide().siblings('#game-play-box').show();
                })

                //
                $('.notice').click(function() {
                    $('.result-mask').hide();
                })
            }
        });
        new Vue({
            el: '#app',
        });
    </script>
</body>

</html>